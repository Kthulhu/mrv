#!/usr/bin/env python
# -*- coding: utf-8 -*-
"""Prepares the nose test environment for use with mrv"""
import sys
import os

__docformat__ = "restructuredtext"

def tmrvmain(args):
	"""Launch mrv main with customized startup"""
	# we assume to be launched using a relative path 
	ospd = os.path.dirname
	# mrv/test/bin/tmrv -> mrv/bin/mrv
	mrvpath = os.path.join(ospd(ospd(ospd(os.path.realpath(os.path.abspath(__file__))))), 'bin', 'mrv')
	globals()['__name__'] = "prevent execution of main"
	# mrv assumes its being started from mrv/bin
	globals()['__file__'] = mrvpath
	
	try:
		fp = open(mrvpath)
		exec fp in globals()
		fp.close()
	except Exception, e:
		raise EnvironmentError("Could not execute mrv at %r with error %s" % (mrvpath, e))
	# END exception handling
	
	# NOTE: Using the module (-m) does not work in py2.4 apparently
	args_mod = lambda a: ('-c', 'import mrv.test.cmds.nosestartup') + a
	mrvmain(args, args_modifier=args_mod)
	
	
if __name__ == "__main__":
	# ignore first arg which is the executable
	tmrvmain(sys.argv[1:])
# END initialization 
